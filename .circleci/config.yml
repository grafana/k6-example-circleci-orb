version: 2
jobs:
 deploy:
   docker:
     - image: sparatan/k6-example-circleci-orb
   steps:
     - checkout
     - setup_remote_docker:
         version: 19.03.13
    #  - run:
    #      name: Build and push to Docker Hub
    #      command: |
    #        docker build -t $DOCKER_HUB_USER_ID/$IMAGE_NAME:latest .
    #        echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_USER_ID" --password-stdin
    #        docker push $DOCKER_HUB_USER_ID/$IMAGE_NAME:latest
    #  - run:  
    #      name: Build the docker image
    #      command: docker-compose build
     - run:  
         name: Execute tests on the docker image
         command: docker run --rm -i -v "$PWD:/work" xk6-counter:latest run  --out json=/work/out.json /work/loadtests/counter.js
 
workflows:
 version: 2
 build-master:
   jobs:
     - deploy
